<!--pages/search/search.wxml-->
<wxs module="searchUtils" src="./search.wxs"></wxs>
<view class="search-page">
  <!-- é¡¶éƒ¨ Banner -->
  <view class="banner-section" wx:if="{{bannerHotels.length > 0}}">
    <view class="banner-item" wx:for="{{bannerHotels}}" wx:key="id" bindtap="handleHotelClick" data-hotel="{{item}}">
      <image class="banner-image" src="{{item.images[0].imageUrl}}" mode="aspectFill" lazy-load="{{true}}" />
      <view class="banner-info">
        <view class="banner-name">{{item.nameCn}}</view>
        <view class="banner-address">{{item.address}}</view>
      </view>
    </view>
  </view>

  <!-- æŸ¥è¯¢è¡¨å• -->
  <view class="search-form">
    <!-- åŸå¸‚é€‰æ‹© -->
    <view class="form-item">
      <view class="form-label">
        <text class="icon">ğŸ“</text>
        <text>åŸå¸‚</text>
      </view>
      <view class="form-value" bindtap="showCityPicker">
        <text>{{city}}</text>
        <text class="arrow">â€º</text>
      </view>
    </view>

    <!-- æ—¥æœŸé€‰æ‹© -->
    <view class="form-item">
      <view class="form-label">
        <text class="icon">ğŸ“…</text>
        <text>å…¥ä½</text>
      </view>
      <view class="form-value">
        <date-picker value="{{checkIn}}" bind:change="handleCheckInChange" />
      </view>
    </view>

    <view class="form-item">
      <view class="form-label">
        <text class="icon">ğŸ“…</text>
        <text>ç¦»åº—</text>
      </view>
      <view class="form-value">
        <date-picker value="{{checkOut}}" minDate="{{checkIn}}" bind:change="handleCheckOutChange" />
      </view>
    </view>

    <view class="nights-info">
      <text>å…± {{nights}} æ™š</text>
    </view>

    <!-- å…³é”®è¯æœç´¢ -->
    <view class="form-item">
      <view class="form-label">
        <text class="icon">ğŸ”</text>
        <text>å…³é”®è¯</text>
      </view>
      <view class="form-value">
        <input 
          class="keyword-input" 
          placeholder="ä½ç½®ã€å“ç‰Œæˆ–é…’åº—åç§°" 
          value="{{keyword}}"
          bindinput="handleKeywordInput"
        />
      </view>
    </view>

    <!-- GPS å®šä½æŒ‰é’® -->
    <view class="gps-button" bindtap="handleGpsLocation">
      <text class="icon">ğŸ“</text>
      <text>ä½¿ç”¨å½“å‰ä½ç½®</text>
    </view>

    <!-- æ˜Ÿçº§ç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-title">æ˜Ÿçº§</view>
      <view class="filter-options">
        <view 
          class="filter-option {{starRating === item.value ? 'active' : ''}}"
          wx:for="{{starOptions}}"
          wx:key="value"
          data-value="{{item.value}}"
          bindtap="handleStarSelect"
        >
          {{item.label}}
        </view>
      </view>
    </view>

    <!-- ä»·æ ¼ç­›é€‰ -->
    <view class="filter-section">
      <view class="filter-title">ä»·æ ¼</view>
      <view class="filter-options">
        <view 
          class="filter-option {{priceRange === item ? 'active' : ''}}"
          wx:for="{{priceOptions}}"
          wx:key="*this"
          data-value="{{item}}"
          bindtap="handlePriceSelect"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ ‡ç­¾ -->
    <view class="filter-section">
      <view class="filter-title">è®¾æ–½</view>
      <view class="tag-list">
        <view 
          class="tag-item {{searchUtils.isTagSelected(selectedTags, item) ? 'active' : ''}}"
          wx:for="{{quickTags}}"
          wx:key="*this"
          data-tag="{{item}}"
          bindtap="handleTagToggle"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- æœç´¢æŒ‰é’® -->
    <button class="search-button" bindtap="handleSearch">
      æœç´¢é…’åº—
    </button>
  </view>

  <!-- æ¨èé…’åº— -->
  <view class="recommend-section" wx:if="{{recommendHotels.length > 0}}">
    <view class="section-title">ä¸ºæ‚¨æ¨è</view>
    <scroll-view class="recommend-list" scroll-x>
      <view class="recommend-item" wx:for="{{recommendHotels}}" wx:key="id">
        <hotel-card hotel="{{item}}" bind:click="handleHotelClick" />
      </view>
    </scroll-view>
  </view>

  <!-- åŸå¸‚é€‰æ‹©å™¨å¼¹çª— -->
  <view class="city-picker-modal" wx:if="{{showCityPicker}}" bindtap="hideCityPicker">
    <view class="city-picker-content" catchtap="{{null}}">
      <view class="city-picker-header">
        <text class="city-picker-title">é€‰æ‹©åŸå¸‚</text>
        <text class="city-picker-close" bindtap="hideCityPicker">âœ•</text>
      </view>
      <view class="city-list">
        <view 
          class="city-item {{city === item ? 'active' : ''}}"
          wx:for="{{popularCities}}"
          wx:key="*this"
          data-city="{{item}}"
          bindtap="handleCitySelect"
        >
          {{item}}
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æç¤º -->
  <view class="loading-mask" wx:if="{{loading}}">
    <view class="loading-content">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
