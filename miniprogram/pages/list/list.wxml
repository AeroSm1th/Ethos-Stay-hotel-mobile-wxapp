<!--pages/list/list.wxml-->
<wxs module="listUtils" src="./list.wxs"></wxs>
<scroll-view class="container" scroll-y="{{true}}" enable-back-to-top="{{true}}">
  <!-- 顶部筛选条件展示区域 -->
  <view class="filter-header" bindtap="toggleFilterPanel">
    <view class="filter-info">
      <view class="filter-item">
        <text class="city">{{filters.city}}</text>
      </view>
      <view class="filter-item">
        <text class="date">{{filters.checkIn}}</text>
        <text class="date-separator">至</text>
        <text class="date">{{filters.checkOut}}</text>
      </view>
      <view class="filter-item">
        <text class="nights">共{{nights}}晚</text>
      </view>
    </view>
    <view class="filter-edit">
      <text class="edit-icon">{{showFilterPanel ? '▲' : '▼'}}</text>
    </view>
  </view>

  <!-- 筛选面板 -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <!-- 城市选择 -->
    <view class="filter-row">
      <view class="filter-label">城市</view>
      <view class="filter-value" bindtap="showCityPicker">
        <text>{{filters.city}}</text>
        <text class="arrow">›</text>
      </view>
    </view>

    <!-- 日期选择 -->
    <view class="filter-row">
      <view class="filter-label">入住</view>
      <view class="filter-value date-picker-wrapper">
        <date-picker value="{{filters.checkIn}}" bind:change="handleCheckInChange" />
      </view>
    </view>

    <view class="filter-row">
      <view class="filter-label">离店</view>
      <view class="filter-value date-picker-wrapper">
        <date-picker value="{{filters.checkOut}}" minDate="{{filters.checkIn}}" bind:change="handleCheckOutChange" />
      </view>
    </view>

    <!-- 关键词搜索 -->
    <view class="filter-row">
      <view class="filter-label">关键词</view>
      <view class="filter-value">
        <input 
          class="keyword-input" 
          placeholder="位置、品牌或酒店名称" 
          value="{{filters.keyword}}"
          bindinput="handleKeywordInput"
        />
      </view>
    </view>

    <!-- 应用筛选按钮 -->
    <view class="filter-actions">
      <button class="apply-button" bindtap="applyFilters">应用筛选</button>
    </view>
  </view>

  <!-- 城市选择器弹窗 -->
  <view class="city-picker-modal" wx:if="{{showCityPicker}}" bindtap="hideCityPicker">
    <view class="city-picker-content" catchtap="{{null}}">
      <view class="city-picker-header">
        <text class="city-picker-title">选择城市</text>
        <text class="city-picker-close" bindtap="hideCityPicker">×</text>
      </view>
      <view class="city-list">
        <view 
          class="city-item {{filters.city === item ? 'active' : ''}}"
          wx:for="{{popularCities}}"
          wx:key="*this"
          data-city="{{item}}"
          bindtap="handleCitySelect"
        >
          {{item}}
        </view>
      </view>
    </view>
  </view>

  <!-- 酒店总数 -->
  <view class="hotel-count" wx:if="{{!loading && total > 0}}">
    <text>共找到 {{total}} 家酒店</text>
  </view>

  <!-- 排序选项 -->
  <view class="sort-bar" wx:if="{{!loading && hotels.length > 0}}">
    <block wx:for="{{sortOptions}}" wx:key="key">
      <view 
        class="sort-item {{sortBy === item.key ? 'active' : ''}}"
        data-sortby="{{item.key}}"
        bindtap="handleSort"
      >
        <text>{{item.label}}</text>
      </view>
    </block>
  </view>

  <!-- 星级筛选 -->
  <view class="filter-section" wx:if="{{!loading}}">
    <view class="filter-title">星级</view>
    <view class="filter-options">
      <block wx:for="{{starOptions}}" wx:key="value">
        <view 
          class="filter-option {{selectedStarRating === item.value ? 'active' : ''}}"
          data-value="{{item.value}}"
          bindtap="handleStarSelect"
        >
          <text>{{item.label}}</text>
        </view>
      </block>
    </view>
  </view>

  <!-- 价格筛选 -->
  <view class="filter-section" wx:if="{{!loading}}">
    <view class="filter-title">价格</view>
    <view class="filter-options">
      <block wx:for="{{priceOptions}}" wx:key="*this">
        <view 
          class="filter-option {{selectedPriceRange === item ? 'active' : ''}}"
          data-value="{{item}}"
          bindtap="handlePriceSelect"
        >
          <text>{{item}}</text>
        </view>
      </block>
    </view>
  </view>

  <!-- 快捷标签 -->
  <view class="quick-tags" wx:if="{{!loading && quickTags.length > 0}}">
    <block wx:for="{{quickTags}}" wx:key="*this">
      <view 
        class="tag-item {{listUtils.isTagSelected(selectedTags, item) ? 'active' : ''}}"
        data-tag="{{item}}"
        bindtap="handleTagClick"
      >
        <text>{{item}}</text>
      </view>
    </block>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 错误提示 -->
  <view class="error-container" wx:if="{{!loading && error}}">
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadHotels" data-append="{{false}}">重试</button>
  </view>

  <!-- 酒店列表 -->
  <view class="hotel-list" wx:if="{{!loading && hotels.length > 0}}">
    <block wx:for="{{hotels}}" wx:key="id">
      <hotel-card 
        hotel="{{item}}" 
        show-price="{{true}}"
        bind:click="handleHotelClick"
      />
    </block>
  </view>

  <!-- 加载更多状态 -->
  <view class="load-more" wx:if="{{loadingMore}}">
    <text class="load-more-text">加载中...</text>
  </view>

  <!-- 没有更多数据 -->
  <view class="no-more" wx:if="{{!hasMore && hotels.length > 0}}">
    <text class="no-more-text">没有更多数据了</text>
  </view>
</scroll-view>
