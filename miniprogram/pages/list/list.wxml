<!--pages/list/list.wxml-->
<wxs module="listUtils" src="./list.wxs"></wxs>
<scroll-view class="container" scroll-y="{{true}}" enable-back-to-top="{{true}}">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-nav-bar">
    <view class="nav-left" bindtap="onBack">
      <text class="nav-icon">â†</text>
    </view>
    <view class="nav-title">é…’åº—åˆ—è¡¨</view>
    <view class="nav-right"></view>
  </view>

  <!-- é¡¶éƒ¨ç­›é€‰æ¡ä»¶å±•ç¤ºåŒºåŸŸ -->
  <view class="filter-header" bindtap="toggleFilterPanel">
    <view class="filter-info">
      <view class="filter-item">
        <text class="filter-icon">ğŸ“</text>
        <text class="city">{{filters.city}}</text>
      </view>
      <view class="filter-item">
        <text class="filter-icon">ğŸ“…</text>
        <text class="date">{{filters.checkIn}}</text>
        <text class="date-separator">è‡³</text>
        <text class="date">{{filters.checkOut}}</text>
      </view>
      <view class="filter-item">
        <text class="nights">å…±{{nights}}æ™š</text>
      </view>
    </view>
    <view class="filter-edit">
      <text class="edit-icon">{{showFilterPanel ? 'â–²' : 'â–¼'}}</text>
    </view>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <!-- åŸå¸‚é€‰æ‹© -->
    <view class="filter-row">
      <view class="filter-label">åŸå¸‚</view>
      <view class="filter-value" bindtap="showCityPicker">
        <text>{{filters.city}}</text>
        <text class="arrow">â€º</text>
      </view>
    </view>

    <!-- æ—¥æœŸé€‰æ‹© -->
    <view class="filter-row">
      <view class="filter-label">å…¥ä½</view>
      <view class="filter-value date-picker-wrapper">
        <date-picker value="{{filters.checkIn}}" bind:change="handleCheckInChange" />
      </view>
    </view>

    <view class="filter-row">
      <view class="filter-label">ç¦»åº—</view>
      <view class="filter-value date-picker-wrapper">
        <date-picker value="{{filters.checkOut}}" minDate="{{filters.checkIn}}" bind:change="handleCheckOutChange" />
      </view>
    </view>

    <!-- å…³é”®è¯æœç´¢ -->
    <view class="filter-row">
      <view class="filter-label">å…³é”®è¯</view>
      <view class="filter-value">
        <input 
          class="keyword-input" 
          placeholder="ä½ç½®ã€å“ç‰Œæˆ–é…’åº—åç§°" 
          value="{{filters.keyword}}"
          bindinput="handleKeywordInput"
        />
      </view>
    </view>

    <!-- åº”ç”¨ç­›é€‰æŒ‰é’® -->
    <view class="filter-actions">
      <button class="apply-button" bindtap="applyFilters">åº”ç”¨ç­›é€‰</button>
    </view>
  </view>

  <!-- åŸå¸‚é€‰æ‹©å™¨å¼¹çª— -->
  <view class="city-picker-modal" wx:if="{{showCityPicker}}" bindtap="hideCityPicker">
    <view class="city-picker-content" catchtap="{{null}}">
      <view class="city-picker-header">
        <text class="city-picker-title">é€‰æ‹©åŸå¸‚</text>
        <text class="city-picker-close" bindtap="hideCityPicker">âœ•</text>
      </view>
      <view class="city-list">
        <view 
          class="city-item {{filters.city === item ? 'active' : ''}}"
          wx:for="{{popularCities}}"
          wx:key="*this"
          data-city="{{item}}"
          bindtap="handleCitySelect"
        >
          {{item}}
        </view>
      </view>
    </view>
  </view>

  <!-- é…’åº—æ€»æ•° -->
  <view class="hotel-count" wx:if="{{!loading && total > 0}}">
    <text>å…±æ‰¾åˆ° {{total}} å®¶é…’åº—</text>
  </view>

  <!-- æ’åºé€‰é¡¹ -->
  <view class="sort-bar" wx:if="{{!loading && hotels.length > 0}}">
    <block wx:for="{{sortOptions}}" wx:key="key">
      <view 
        class="sort-item {{sortBy === item.key ? 'active' : ''}}"
        data-sortby="{{item.key}}"
        bindtap="handleSort"
      >
        <text>{{item.label}}</text>
      </view>
    </block>
  </view>

  <!-- æ˜Ÿçº§ç­›é€‰ -->
  <view class="filter-section" wx:if="{{!loading}}">
    <view class="filter-title">æ˜Ÿçº§</view>
    <view class="filter-options">
      <block wx:for="{{starOptions}}" wx:key="value">
        <view 
          class="filter-option {{selectedStarRating === item.value ? 'active' : ''}}"
          data-value="{{item.value}}"
          bindtap="handleStarSelect"
        >
          <text>{{item.label}}</text>
        </view>
      </block>
    </view>
  </view>

  <!-- ä»·æ ¼ç­›é€‰ -->
  <view class="filter-section" wx:if="{{!loading}}">
    <view class="filter-title">ä»·æ ¼</view>
    <view class="filter-options">
      <block wx:for="{{priceOptions}}" wx:key="*this">
        <view 
          class="filter-option {{selectedPriceRange === item ? 'active' : ''}}"
          data-value="{{item}}"
          bindtap="handlePriceSelect"
        >
          <text>{{item}}</text>
        </view>
      </block>
    </view>
  </view>

  <!-- å¿«æ·æ ‡ç­¾ -->
  <view class="quick-tags" wx:if="{{!loading && quickTags.length > 0}}">
    <block wx:for="{{quickTags}}" wx:key="*this">
      <view 
        class="tag-item {{listUtils.isTagSelected(selectedTags, item) ? 'active' : ''}}"
        data-tag="{{item}}"
        bindtap="handleTagClick"
      >
        <text>{{item}}</text>
      </view>
    </block>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-container" wx:if="{{!loading && error}}">
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadHotels" data-append="{{false}}">é‡è¯•</button>
  </view>

  <!-- é…’åº—åˆ—è¡¨ -->
  <view class="hotel-list" wx:if="{{!loading && hotels.length > 0}}">
    <block wx:for="{{hotels}}" wx:key="id">
      <hotel-card 
        hotel="{{item}}" 
        show-price="{{true}}"
        bind:click="handleHotelClick"
      />
    </block>
  </view>

  <!-- åŠ è½½æ›´å¤šçŠ¶æ€ -->
  <view class="load-more" wx:if="{{loadingMore}}">
    <text class="load-more-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more" wx:if="{{!hasMore && hotels.length > 0}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
  </view>
</scroll-view>
