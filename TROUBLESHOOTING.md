# 故障排除指南

## 问题：酒店列表价格显示为 ¥0

### 症状
- 所有酒店卡片显示价格为 ¥0
- 星级都显示为 2 星
- 设施标签都一样

### 已确认的事实
✅ 后端 API 返回正确的数据
✅ 价格数据存在（如 ¥333、¥349、¥265）
✅ 星级数据正确（都是 2 星是正常的，因为这批测试数据确实都是 2 星）
✅ 设施数据不同（每个酒店有不同的设施）
✅ 前端代码已修复（支持字符串格式的价格）

### 可能的原因

#### 1. 微信开发者工具未重新编译

**解决方案**：
1. 在微信开发者工具中点击"编译"按钮
2. 或者按 `Ctrl + B` (Windows) / `Cmd + B` (Mac)
3. 或者点击"清缓存" → "清除所有缓存" → 重新编译

#### 2. 组件缓存问题

**解决方案**：
1. 关闭微信开发者工具
2. 重新打开项目
3. 点击"编译"

#### 3. TypeScript 编译问题

**解决方案**：
```bash
cd hotel-mobile-wxapp
# 清理 node_modules
rm -rf node_modules
# 重新安装依赖
npm install
# 重新编译
npm run compile
```

#### 4. 组件未正确注册

**检查步骤**：
1. 打开 `miniprogram/pages/list/list.json`
2. 确认包含：
```json
{
  "usingComponents": {
    "hotel-card": "/components/hotel-card/hotel-card"
  }
}
```

### 调试步骤

#### 步骤 1：检查控制台日志

在微信开发者工具的控制台中，应该能看到类似的日志：

```
hotel-card: hotel 数据变化 {id: 19981, nameCn: "上海尚客优公寓酒店42号店", ...}
hotel-card: calculateMinPrice 被调用 {id: 19981, ...}
hotel-card: 房型数据 [{name: "标准间", price: "349.00", ...}, ...]
hotel-card: 房型 标准间, 原始价格: 349.00, 转换后: 349
hotel-card: 房型 双床房, 原始价格: 436.00, 转换后: 436
hotel-card: 房型 大床房, 原始价格: 446.00, 转换后: 446
hotel-card: 最低价格 349
```

如果看不到这些日志，说明组件没有正确加载。

#### 步骤 2：检查数据绑定

在控制台中输入：
```javascript
getCurrentPages()[0].data.hotels[0]
```

应该能看到完整的酒店数据，包括 `roomTypes` 数组。

#### 步骤 3：手动触发重新渲染

在控制台中输入：
```javascript
const page = getCurrentPages()[0];
page.setData({ hotels: page.data.hotels });
```

这会强制重新渲染所有酒店卡片。

### 验证修复

运行调试脚本验证后端数据：
```bash
cd hotel-mobile-wxapp
node debug-hotel-data.js
```

应该看到：
```
✅ 最低价格: ¥349
✅ 最低价格: ¥333
✅ 最低价格: ¥265
```

### 最终解决方案

如果以上方法都不行，请尝试：

1. **完全重启微信开发者工具**
   - 关闭所有微信开发者工具窗口
   - 重新打开项目
   - 点击"清缓存" → "清除所有缓存"
   - 重新编译

2. **检查微信开发者工具版本**
   - 确保使用最新稳定版
   - 如果版本过旧，可能不支持某些特性

3. **检查项目配置**
   - 打开 `project.config.json`
   - 确认 `miniprogramRoot` 设置为 `"miniprogram/"`
   - 确认 `compileType` 设置为 `"miniprogram"`

4. **重新创建组件实例**
   - 删除 `miniprogram/components/hotel-card` 目录
   - 从 Git 重新检出
   - 重新编译

### 联系支持

如果问题仍然存在，请提供：
1. 微信开发者工具版本号
2. 控制台完整日志
3. `getCurrentPages()[0].data.hotels[0]` 的输出
4. 截图显示问题

## 关于星级和设施

### 星级都是 2 星
这是**正常的**！当前测试数据中的上海酒店确实都是 2 星级。这不是 bug。

如果需要不同星级的酒店，可以：
1. 搜索其他城市（如北京、广州）
2. 或者在后端生成更多样化的测试数据

### 设施标签看起来一样
仔细观察，设施其实是不同的：
- 酒店 1：免费WiFi、24小时前台、豪华、管家服务
- 酒店 2：免费WiFi、24小时前台、豪华、管家服务、VIP服务、私人泳池
- 酒店 3：免费WiFi、24小时前台、豪华、行政酒廊、管家服务、米其林餐厅

前三个标签可能相同，但完整列表是不同的。
